{"ast":null,"code":"import _asyncToGenerator from \"/home/joao/Projects/payment-live-chat/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpHeaders } from '@angular/common/http';\nimport { environment } from '../../environments/environment';\nimport { firstValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"keycloak-angular\";\nimport * as i2 from \"@angular/common/http\";\nexport class AuthService {\n  constructor(keycloak, http) {\n    this.keycloak = keycloak;\n    this.http = http;\n  }\n  login() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      yield _this.keycloak.login({\n        redirectUri: window.location.origin + '/home'\n      });\n    })();\n  }\n  register() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      yield _this2.keycloak.register({\n        redirectUri: window.location.origin + '/home'\n      });\n    })();\n  }\n  logout() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      yield _this3.keycloak.logout(window.location.origin);\n    })();\n  }\n  isLoggedIn() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      return yield _this4.keycloak.isLoggedIn();\n    })();\n  }\n  getProfile() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      return yield _this5.keycloak.loadUserProfile();\n    })();\n  }\n  getToken() {\n    return this.keycloak.getKeycloakInstance().token || '';\n  }\n  getUsername() {\n    return this.keycloak.getUsername();\n  }\n  hasRole(role) {\n    return this.keycloak.isUserInRole(role);\n  }\n  syncUserToBackend() {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const token = _this6.getToken();\n        const headers = new HttpHeaders({\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        });\n        yield firstValueFrom(_this6.http.post(`${environment.apiUrl}/users/sync`, {}, {\n          headers\n        }));\n      } catch (error) {\n        console.error('Error syncing user to backend:', error);\n      }\n    })();\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.KeycloakService), i0.ɵɵinject(i2.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["HttpHeaders","environment","firstValueFrom","AuthService","constructor","keycloak","http","login","_this","_asyncToGenerator","redirectUri","window","location","origin","register","_this2","logout","_this3","isLoggedIn","_this4","getProfile","_this5","loadUserProfile","getToken","getKeycloakInstance","token","getUsername","hasRole","role","isUserInRole","syncUserToBackend","_this6","headers","post","apiUrl","error","console","i0","ɵɵinject","i1","KeycloakService","i2","HttpClient","factory","ɵfac","providedIn"],"sources":["/home/joao/Projects/payment-live-chat/frontend/src/app/services/auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { KeycloakService } from 'keycloak-angular';\nimport { KeycloakProfile } from 'keycloak-js';\nimport { environment } from '../../environments/environment';\nimport { firstValueFrom } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  constructor(\n    private keycloak: KeycloakService,\n    private http: HttpClient\n  ) {}\n\n  async login(): Promise<void> {\n    await this.keycloak.login({\n      redirectUri: window.location.origin + '/home'\n    });\n  }\n\n  async register(): Promise<void> {\n    await this.keycloak.register({\n      redirectUri: window.location.origin + '/home'\n    });\n  }\n\n  async logout(): Promise<void> {\n    await this.keycloak.logout(window.location.origin);\n  }\n\n  async isLoggedIn(): Promise<boolean> {\n    return await this.keycloak.isLoggedIn();\n  }\n\n  async getProfile(): Promise<KeycloakProfile> {\n    return await this.keycloak.loadUserProfile();\n  }\n\n  getToken(): string {\n    return this.keycloak.getKeycloakInstance().token || '';\n  }\n\n  getUsername(): string {\n    return this.keycloak.getUsername();\n  }\n\n  hasRole(role: string): boolean {\n    return this.keycloak.isUserInRole(role);\n  }\n\n  async syncUserToBackend(): Promise<void> {\n    try {\n      const token = this.getToken();\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      });\n\n      await firstValueFrom(\n        this.http.post(`${environment.apiUrl}/users/sync`, {}, { headers })\n      );\n    } catch (error) {\n      console.error('Error syncing user to backend:', error);\n    }\n  }\n}\n"],"mappings":";AACA,SAAqBA,WAAW,QAAQ,sBAAsB;AAG9D,SAASC,WAAW,QAAQ,gCAAgC;AAC5D,SAASC,cAAc,QAAQ,MAAM;;;;AAKrC,OAAM,MAAOC,WAAW;EACtBC,YACUC,QAAyB,EACzBC,IAAgB;IADhB,KAAAD,QAAQ,GAARA,QAAQ;IACR,KAAAC,IAAI,GAAJA,IAAI;EACX;EAEGC,KAAKA,CAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MACT,MAAMD,KAAI,CAACH,QAAQ,CAACE,KAAK,CAAC;QACxBG,WAAW,EAAEC,MAAM,CAACC,QAAQ,CAACC,MAAM,GAAG;OACvC,CAAC;IAAC;EACL;EAEMC,QAAQA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAN,iBAAA;MACZ,MAAMM,MAAI,CAACV,QAAQ,CAACS,QAAQ,CAAC;QAC3BJ,WAAW,EAAEC,MAAM,CAACC,QAAQ,CAACC,MAAM,GAAG;OACvC,CAAC;IAAC;EACL;EAEMG,MAAMA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAR,iBAAA;MACV,MAAMQ,MAAI,CAACZ,QAAQ,CAACW,MAAM,CAACL,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC;IAAC;EACrD;EAEMK,UAAUA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAV,iBAAA;MACd,aAAaU,MAAI,CAACd,QAAQ,CAACa,UAAU,EAAE;IAAC;EAC1C;EAEME,UAAUA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAZ,iBAAA;MACd,aAAaY,MAAI,CAAChB,QAAQ,CAACiB,eAAe,EAAE;IAAC;EAC/C;EAEAC,QAAQA,CAAA;IACN,OAAO,IAAI,CAAClB,QAAQ,CAACmB,mBAAmB,EAAE,CAACC,KAAK,IAAI,EAAE;EACxD;EAEAC,WAAWA,CAAA;IACT,OAAO,IAAI,CAACrB,QAAQ,CAACqB,WAAW,EAAE;EACpC;EAEAC,OAAOA,CAACC,IAAY;IAClB,OAAO,IAAI,CAACvB,QAAQ,CAACwB,YAAY,CAACD,IAAI,CAAC;EACzC;EAEME,iBAAiBA,CAAA;IAAA,IAAAC,MAAA;IAAA,OAAAtB,iBAAA;MACrB,IAAI;QACF,MAAMgB,KAAK,GAAGM,MAAI,CAACR,QAAQ,EAAE;QAC7B,MAAMS,OAAO,GAAG,IAAIhC,WAAW,CAAC;UAC9B,eAAe,EAAE,UAAUyB,KAAK,EAAE;UAClC,cAAc,EAAE;SACjB,CAAC;QAEF,MAAMvB,cAAc,CAClB6B,MAAI,CAACzB,IAAI,CAAC2B,IAAI,CAAC,GAAGhC,WAAW,CAACiC,MAAM,aAAa,EAAE,EAAE,EAAE;UAAEF;QAAO,CAAE,CAAC,CACpE;OACF,CAAC,OAAOG,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;;IACvD;EACH;;;uBAxDWhC,WAAW,EAAAkC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,eAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,UAAA;IAAA;EAAA;;;aAAXvC,WAAW;MAAAwC,OAAA,EAAXxC,WAAW,CAAAyC,IAAA;MAAAC,UAAA,EAFV;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}